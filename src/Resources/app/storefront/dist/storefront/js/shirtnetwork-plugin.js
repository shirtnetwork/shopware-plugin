(window.webpackJsonp=window.webpackJsonp||[]).push([["shirtnetwork-plugin"],{e6Wf:function(t,e,s){"use strict";s.r(e);var n=s("4CNy"),i=s("MRVv"),r=s("yRbc"),o=s("4X/C"),a=s("4i2v");class c{constructor(t){this.client=new o.a;const e=this.client._createPreparedRequest.bind(this.client);this.client._createPreparedRequest=function(s,n,i){const r=e(s,n,i);return r.setRequestHeader("sw-access-key",t),r}}async post(t,e){return await this.toPromise(this.client.post(t,e,this.callback))}async get(t){return this.toPromise(this.client.get(t,this.callback))}toPromise(t){return new Promise((function(e,s){t.onreadystatechange=function(){4===t.readyState&&(t.status>=200&&t.status<300?e(t.responseText):s({status:t.status,statusText:t.statusText}))}}))}callback(){}}var d,h,u,l=t=>new Promise(((e,s)=>{const n=document.createElement("script");n.src=t,n.async=!0,n.onerror=s,n.onload=n.onreadystatechange=function(){const t=this.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,e())},document.head.appendChild(n)}));function p(t,e){if(null==t)return e;for(var s in e)e[s].constructor===Object?t[s]=p(t[s],e[s]):void 0===t[s]&&(t[s]=e[s]);return t}function g(){return(g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t}).apply(this,arguments)}class f extends n.a{init(){a.a.create(),this._httpClient=new o.a,this.client=new c(this.options.swAccessKey),this.cartItems=[],this.cache={},this.skuScheme=this.options.skuScheme||"{PRODUCT_SKU}-{VARIANT_SKU}-{SIZE_SKU}",this.pages=this.options.pages||{},l("//cdn.shirtnetwork.de/client/shirtnetwork-client.js").then((()=>this.boot()))}async boot(){const t=p(this.options,{settings:{container:this.el.id,shop:{cart:{link:window.router["frontend.checkout.cart.page"],data:{},handler:this.getCheckoutData.bind(this),addItem:this.addItemToCart.bind(this),submit:this.submitCart.bind(this),init:()=>{},showAfterSalesModal:!1},infos:{handler:this.getShopInfos.bind(this)},stock:{handler:this.getStockInfos.bind(this)}}}});(this.instance=await ShirtnetworkClient.init(t)).$store.dispatch("observe",{event:"navigate",callback:this.navigate.bind(this)}),setTimeout((()=>a.a.remove()),1500)}async addItemToCart(t,e,s){this.cartItems.push({type:"product",referencedId:s.oxid,quantity:Number.parseInt(s.amount),payload:{shirtnetwork:t}})}async getShopInfos(t){return await this.getProduct(t)}async getStockInfos(t){const e=this.resolveSku(t.psku,t.vsku,t.ssku);if(e){const t=JSON.parse(await this.client.post("/store-api/product",JSON.stringify({associations:{children:{}},includes:{product:["children","id","productNumber","availableStock","isCloseout","extensions","shirtnetwork_sku"]},filter:[{type:"equals",field:"children.productNumber",value:e}]}),!0));if(t.elements.length){return t.elements[0].children.map((t=>({size:t.extensions.shirtnetwork_sku.sartnr,variant:t.extensions.shirtnetwork_sku.vartnr,stock:t.isCloseout?t.availableStock:999999})))}}return[]}async getCheckoutData(t){const e=await this.getProduct(t);let s;if(t.sskus){s=[];for(const e of t.sskus){const n=await this.getProduct(g({},t,{ssku:e.sku}));n&&s.push({oxid:n.id,id:n.id,amount:e.amount,size:e.size})}}return{aid:e?e.id:void 0,sizes:s.length?s:void 0}}async getProduct(t){const e=this.resolveSku(t.psku,t.vsku,t.ssku);if(e){if(this.cache[e])return this.cache[e];const s=JSON.parse(await this.client.post("/store-api/product",JSON.stringify({filter:[{type:"equals",field:"productNumber",value:this.resolveSku(t.psku,t.vsku,t.ssku)}]}),!0));return console.log("after getProduct",s),this.cache[e]=s.elements&&s.elements.length?s.elements[0]:{},this.cache[e]}return{}}async submitCart(){const t=await this.client.post("/shirtnetwork/add-to-cart",JSON.stringify({lineItems:this.cartItems}));return this.cartItems=[],this.instance.$store.dispatch("setIsNavigatingToCart",!0),this.openOffCanvas(),t}navigate(t){this.pages[t]&&(a.a.create(),this._httpClient.get(this.pages[t],(t=>{a.a.remove();new r.a(t).open()})))}openOffCanvas(){const t=i.a.getPluginInstances("OffCanvasCart");for(const e of t)e.openOffCanvas(window.router["frontend.cart.offcanvas"],!1)}resolveSku(t,e,s){return this.skuScheme.replace("{PRODUCT_SKU}",t).replace("{VARIANT_SKU}",e).replace("{SIZE_SKU}",s)}}u={version:"1.6.4"},(h="options")in(d=f)?Object.defineProperty(d,h,{value:u,enumerable:!0,configurable:!0,writable:!0}):d[h]=u;class k extends n.a{init(){document.body.addEventListener("designerBooted",this.designerBooted.bind(this))}designerBooted(t){this._httpClient=new o.a,this.instance=t.detail,this.instance.$store.watch((function(t,e){return e.localVars}),(()=>this.reloadDescription()),{deep:!0})}async reloadDescription(){const t=this.instance.$store.getters.localVar("shopProductInfos");console.log("reloadDescription",t.id),t&&t.translated?(document.getElementById("designer-description-description-content").innerHTML=t.translated.description,this._httpClient.get("/product/".concat(t.id,"/reviews"),(t=>{document.getElementById("designer-description-reviews-content").innerHTML=t,i.a.initializePlugins()}))):(document.getElementById("designer-description-description-content").innerHTML="",document.getElementById("designer-description-reviews-content").innerHTML="")}}const m=window.PluginManager;m.register("ShirtnetworkPlugin",f,"[data-shirtnetwork-plugin]"),m.register("ShirtnetworkDescriptionPlugin",k,"[data-shirtnetwork-description-plugin]")}},[["e6Wf","runtime","vendor-node","vendor-shared"]]]);