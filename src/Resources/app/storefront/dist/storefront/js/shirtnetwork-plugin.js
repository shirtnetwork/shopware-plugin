"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["shirtnetwork-plugin"],{3467:(t,e,s)=>{var i=s(6285),n=s(378),r=s(8254),a=s(5659);class o{constructor(t){this.client=new r.Z;const e=this.client._createPreparedRequest.bind(this.client);this.client._createPreparedRequest=function(s,i,n){const r=e(s,i,n);return r.setRequestHeader("sw-access-key",t),r}}async post(t,e){return await this.toPromise(this.client.post(t,e,this.callback))}async get(t){return this.toPromise(this.client.get(t,this.callback))}toPromise(t){return new Promise((function(e,s){t.onreadystatechange=function(){4===t.readyState&&(t.status>=200&&t.status<300?e(t.responseText):s({status:t.status,statusText:t.statusText}))}}))}callback(){}}const c=t=>new Promise(((e,s)=>{const i=document.createElement("script");i.src=t,i.async=!0,i.onerror=s,i.onload=i.onreadystatechange=function(){const t=this.readyState;t&&"loaded"!==t&&"complete"!==t||(i.onload=i.onreadystatechange=null,e())},document.head.appendChild(i)}));function h(t,e){if(null==t)return e;for(var s in e)e[s].constructor===Object?t[s]=h(t[s],e[s]):void 0===t[s]&&(t[s]=e[s]);return t}class u extends i.Z{init(){a.Z.create(),this._httpClient=new r.Z,this.client=new o(this.options.swAccessKey),this.cartItems=[],this.cache={},this.skuScheme=this.options.skuScheme||"{PRODUCT_SKU}-{VARIANT_SKU}-{SIZE_SKU}",this.pages=this.options.pages||{},c("//cdn.shirtnetwork.de/client/shirtnetwork-client.js").then((()=>this.boot()))}async boot(){const t=h(this.options,{settings:{container:this.el.id,shop:{cart:{link:"/checkout/cart",data:{},handler:this.getCheckoutData.bind(this),addItem:this.addItemToCart.bind(this),submit:this.submitCart.bind(this),init:()=>{},showAfterSalesModal:!1},infos:{handler:this.getShopInfos.bind(this)},stock:{handler:this.getStockInfos.bind(this)}}}}),e=this.instance=await ShirtnetworkClient.init(t);this.options.translations&&e.$store.dispatch("setTranslation",{lang:this.options.language.split("-")[0].toLowerCase(),translation:this.options.translations}),e.$store.dispatch("setLanguage",this.options.language),e.$store.dispatch("observe",{event:"navigate",callback:this.navigate.bind(this)}),setTimeout((()=>a.Z.remove()),1500)}async addItemToCart(t,e,s){this.cartItems.push({type:"product",referencedId:s.oxid,quantity:Number.parseInt(s.amount),payload:{shirtnetwork:t}})}async getShopInfos(t){return await this.getProduct(t)}async getStockInfos(t){const e=this.resolveSku(t.psku,t.vsku,t.ssku);if(e){const t=JSON.parse(await this.client.get("/shirtnetwork/designer-stock-infos/"+e));return null!=t?t:[]}return[]}async getCheckoutData(t){const e=await this.getProduct(t);let s;if(t.sskus){s=[];for(const e of t.sskus){const i=await this.getProduct(Object.assign({},t,{ssku:e.sku}));i&&s.push({oxid:i.id,id:i.id,amount:e.amount,size:e.size})}}return{aid:e?e.id:void 0,sizes:s.length?s:void 0}}async getProduct(t){const e=this.resolveSku(t.psku,t.vsku,t.ssku);if(e){if(this.cache[e])return this.cache[e];const s=JSON.parse(await this.client.post("/store-api/product",JSON.stringify({filter:[{type:"equals",field:"productNumber",value:this.resolveSku(t.psku,t.vsku,t.ssku)}]}),!0));return console.log("after getProduct",s),this.cache[e]=s.elements&&s.elements.length?s.elements[0]:{},this.cache[e]}return{}}async submitCart(){const t=await this.client.post("/shirtnetwork/add-to-cart",JSON.stringify({lineItems:this.cartItems}));return this.cartItems=[],this.instance.$store.dispatch("setIsNavigatingToCart",!0),this.openOffCanvas(),t}navigate(t){this.pages[t]&&(a.Z.create(),this._httpClient.get(this.pages[t],(t=>{a.Z.remove();new n.Z(t).open()})))}openOffCanvas(){const t=window.PluginManager.getPluginInstances("OffCanvasCart");for(const e of t)e.openOffCanvas(window.router["frontend.cart.offcanvas"],!1)}resolveSku(t,e,s){return this.skuScheme.replace("{PRODUCT_SKU}",t).replace("{VARIANT_SKU}",e).replace("{SIZE_SKU}",s)}}var l,d,p;l=u,p={version:"1.6.4"},(d=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(d="options"))in l?Object.defineProperty(l,d,{value:p,enumerable:!0,configurable:!0,writable:!0}):l[d]=p;var g=s(3206);class f extends i.Z{init(){document.body.addEventListener("designerBooted",this.designerBooted.bind(this))}designerBooted(t){this._httpClient=new r.Z,this._domParser=new DOMParser,this.instance=t.detail,this.instance.$store.watch((function(t,e){return e.localVars}),(()=>this.reloadDescription()),{deep:!0})}async reloadDescription(){const t=this.instance.$store.getters.localVar("shopProductInfos");t?this._httpClient.get(`/shirtnetwork/detail/${t.id}`,(t=>{const e=this._domParser.parseFromString(t,"text/html"),s=g.Z.querySelector(e,".product-detail-tabs");this.el.innerHTML=s.innerHTML,window.PluginManager.initializePlugins()})):this.el.innerHTML=""}}const k=window.PluginManager;k.register("ShirtnetworkPlugin",u,"[data-shirtnetwork-plugin]"),k.register("ShirtnetworkDescriptionPlugin",f,"[data-shirtnetwork-description-plugin]")}},t=>{t.O(0,["vendor-node","vendor-shared"],(()=>{return e=3467,t(t.s=e);var e}));t.O()}]);