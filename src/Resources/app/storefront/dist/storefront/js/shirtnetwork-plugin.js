"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["shirtnetwork-plugin"],{9378:(t,e,s)=>{var n=s(6285),i=s(378),r=s(8254),o=s(5659);class a{constructor(t){this.client=new r.Z;const e=this.client._createPreparedRequest.bind(this.client);this.client._createPreparedRequest=function(s,n,i){const r=e(s,n,i);return r.setRequestHeader("sw-access-key",t),r}}async post(t,e){return await this.toPromise(this.client.post(t,e,this.callback))}async get(t){return this.toPromise(this.client.get(t,this.callback))}toPromise(t){return new Promise((function(e,s){t.onreadystatechange=function(){4===t.readyState&&(t.status>=200&&t.status<300?e(t.responseText):s({status:t.status,statusText:t.statusText}))}}))}callback(){}}const c=t=>new Promise(((e,s)=>{const n=document.createElement("script");n.src=t,n.async=!0,n.onerror=s,n.onload=n.onreadystatechange=function(){const t=this.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,e())},document.head.appendChild(n)}));function d(t,e){if(null==t)return e;for(var s in e)e[s].constructor===Object?t[s]=d(t[s],e[s]):void 0===t[s]&&(t[s]=e[s]);return t}class u extends n.Z{init(){o.Z.create(),this._httpClient=new r.Z,this.client=new a(this.options.swAccessKey),this.cartItems=[],this.cache={},this.skuScheme=this.options.skuScheme||"{PRODUCT_SKU}-{VARIANT_SKU}-{SIZE_SKU}",this.pages=this.options.pages||{},c("//cdn.shirtnetwork.de/client/shirtnetwork-client.js").then((()=>this.boot()))}async boot(){const t=d(this.options,{settings:{container:this.el.id,shop:{cart:{link:"/checkout/cart",data:{},handler:this.getCheckoutData.bind(this),addItem:this.addItemToCart.bind(this),submit:this.submitCart.bind(this),init:()=>{},showAfterSalesModal:!1},infos:{handler:this.getShopInfos.bind(this)},stock:{handler:this.getStockInfos.bind(this)}}}});(this.instance=await ShirtnetworkClient.init(t)).$store.dispatch("observe",{event:"navigate",callback:this.navigate.bind(this)}),setTimeout((()=>o.Z.remove()),1500)}async addItemToCart(t,e,s){this.cartItems.push({type:"product",referencedId:s.oxid,quantity:Number.parseInt(s.amount),payload:{shirtnetwork:t}})}async getShopInfos(t){return await this.getProduct(t)}async getStockInfos(t){const e=this.resolveSku(t.psku,t.vsku,t.ssku);if(e){const t=JSON.parse(await this.client.get("/shirtnetwork/designer-stock-infos/"+e));return null!=t?t:[]}return[]}async getCheckoutData(t){const e=await this.getProduct(t);let s;if(t.sskus){s=[];for(const e of t.sskus){const n=await this.getProduct(Object.assign({},t,{ssku:e.sku}));n&&s.push({oxid:n.id,id:n.id,amount:e.amount,size:e.size})}}return{aid:e?e.id:void 0,sizes:s.length?s:void 0}}async getProduct(t){const e=this.resolveSku(t.psku,t.vsku,t.ssku);if(e){if(this.cache[e])return this.cache[e];const s=JSON.parse(await this.client.post("/store-api/product",JSON.stringify({filter:[{type:"equals",field:"productNumber",value:this.resolveSku(t.psku,t.vsku,t.ssku)}]}),!0));return console.log("after getProduct",s),this.cache[e]=s.elements&&s.elements.length?s.elements[0]:{},this.cache[e]}return{}}async submitCart(){const t=await this.client.post("/shirtnetwork/add-to-cart",JSON.stringify({lineItems:this.cartItems}));return this.cartItems=[],this.instance.$store.dispatch("setIsNavigatingToCart",!0),this.openOffCanvas(),t}navigate(t){this.pages[t]&&(o.Z.create(),this._httpClient.get(this.pages[t],(t=>{o.Z.remove();new i.Z(t).open()})))}openOffCanvas(){const t=window.PluginManager.getPluginInstances("OffCanvasCart");for(const e of t)e.openOffCanvas(window.router["frontend.cart.offcanvas"],!1)}resolveSku(t,e,s){return this.skuScheme.replace("{PRODUCT_SKU}",t).replace("{VARIANT_SKU}",e).replace("{SIZE_SKU}",s)}}var h,l,p;h=u,p={version:"1.6.4"},(l=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var n=s.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(l="options"))in h?Object.defineProperty(h,l,{value:p,enumerable:!0,configurable:!0,writable:!0}):h[l]=p;class g extends n.Z{init(){document.body.addEventListener("designerBooted",this.designerBooted.bind(this))}designerBooted(t){this._httpClient=new r.Z,this.instance=t.detail,this.instance.$store.watch((function(t,e){return e.localVars}),(()=>this.reloadDescription()),{deep:!0})}async reloadDescription(){const t=this.instance.$store.getters.localVar("shopProductInfos");t&&t.translated?(document.getElementById("designer-description-description-content").innerHTML=t.translated.description,this._httpClient.get(`/product/${t.parentId?t.parentId:t.id}/reviews`,(t=>{document.getElementById("designer-description-reviews-content").innerHTML=t,window.PluginManager.initializePlugins()}))):(document.getElementById("designer-description-description-content").innerHTML="",document.getElementById("designer-description-reviews-content").innerHTML="")}}const f=window.PluginManager;f.register("ShirtnetworkPlugin",u,"[data-shirtnetwork-plugin]"),f.register("ShirtnetworkDescriptionPlugin",g,"[data-shirtnetwork-description-plugin]")}},t=>{t.O(0,["vendor-node","vendor-shared"],(()=>{return e=9378,t(t.s=e);var e}));t.O()}]);